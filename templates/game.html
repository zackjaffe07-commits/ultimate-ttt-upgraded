<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Tic Tac Toe</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="bg" data-username="{{ current_user.username }}">

<!-- Confetti canvas -->
<canvas id="confetti-canvas"></canvas>

<!-- Victory Modal -->
<div id="victory-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h1 id="victory-text"></h1>
        <p id="victory-subtext"></p>
    </div>
</div>

<div class="game-page-layout">
    <!-- ===== GAME AREA ===== -->
    <div class="game-container">
        <div class="top-bar">
            <div>
                <h2>Room: {{ room }}</h2>
                <p id="player" class="muted"></p>
            </div>
            <div style="display:flex; gap:6px; align-items:center;">
                <button id="sound-toggle" title="Toggle sound">ðŸ”Š</button>
                <button id="action" class="button primary small" style="display:none;">Start</button>
                <div id="post-game-actions" style="display:none;">
                    <button id="rematch-btn" class="button primary small">Rematch</button>
                    <a href="{{ url_for('home') }}" id="home-btn" class="button secondary small">Home</a>
                </div>
            </div>
        </div>

        <div class="status-card">
            <p id="status">Waiting for playersâ€¦</p>
            <div id="timer-display" class="hidden"></div>
        </div>

        <!-- Player Panel -->
        <div class="player-info-panel">
            <div id="player-X" class="player-info"></div>
            <div class="vs-separator">vs</div>
            <div id="player-O" class="player-info"></div>
        </div>

        <div class="board-wrapper">
            <div id="board"></div>
        </div>
    </div>

    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar">
        <div class="card sidebar-card">
            <h3>Spectators</h3>
            <ul id="spectator-list"><li>No spectators yet.</li></ul>
        </div>

        <div class="card sidebar-card move-history-card">
            <h3>Move History</h3>
            <ul id="move-history-list"><li style="color:#aaa; font-size:0.85rem;">No moves yet.</li></ul>
        </div>

        <div class="card sidebar-card chat-card">
            <h3>Chat</h3>
            <div id="chat-messages"></div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Say something..." maxlength="200">
                <button id="send-chat-btn" class="button primary small">Send</button>
            </div>
            <div class="mute-controls">
                <label><input type="checkbox" id="mute-opponent"> Mute Opponent</label>
                <label><input type="checkbox" id="mute-spectators"> Mute Spectators</label>
            </div>
        </div>
    </div>
</div>

<script>const ROOM = "{{ room }}";</script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/game.js') }}"></script>
</body>
</html>
